# easy-vk-tunnel

Bash-скрипт для лёгкого создания vless-ссылки при использовании vk-tunnel в качестве туннеля между клиентом и сервером для демонстрации проксирования трафика через веб-сокеты.

# Подготовка

У вас на сервере уже должна стоять любая прокси-панель, такая как Marzban, 3x-ui или Remnawave. Впрочем чистое ядро xray тоже подойдёт.

Создайте новый инбаунд vless. Порт выберите на ваше усмотрение. Транспорт через Websockets. Значение Path в веб-сокетах можете оставить по умолчанию: «/» или впишите произвольную директорию, например «/hello-world/». Если вам нужен сниффинг, то можете его включить. Другие настройки не трогайте — оставьте по умолчанию. Если вы больше визуал, то вот [скриншот](https://ibb.co/jPhNwtvc), как это должно выглядеть.

Из инбаунда вам в дальнейшем понадобятся: UUID клиента, выбранный вами порт и значение Path.

# Установка vk-tunnel

Если у вас нет npm, поставьте его. Опционально можете поставить генератор QR-кодов для того, чтобы vless-ссылка в дальнейшем кодировалась ещё и в QR. Этот шаг написан для систем Debian или Ubuntu, но вы можете адаптировать его под себя.

    sudo apt-get update && sudo apt-get install npm qrencode -y

Поставьте vk-tunnel (полная документация [здесь](https://dev.vk.com/ru/libraries/tunnel))

    npm install @vkontakte/vk-tunnel -g

Запустите vk-tunnel

    vk-tunnel

При первом запуске он выдаст auth-ссылку. Перейдите по ней и авторизуйтесь с помощью аккаунта VK. После авторизации нажмите Enter. Vk-tunnel должен выдать два адреса: https:// и wss:// — если это произошло, то вы успешно авторизовались. Убиваем vk-tunnel нажатием Ctrl+C.

# Установка easy-vk-tunnel

Клонируем этот репозиторий себе на сервер

    git clone https://github.com/nebesniy/easy-vk-tunnel.git

Вписываем UUID, порт инбаунда и path в скрипт

    nano easy-vk-tunnel/easy-vk-tunnel.sh

В начале скрипта будут переменные, заполните их по своему созданному инбаунду. Если вы всё ещё визуал, вот [эти](https://ibb.co/MxYmBN4y) переменные. Сохраните файл Ctrl+O → Enter и выйдите из nano Ctrl+X.

Даём скрипту права на исполнение

    chmod +x easy-vk-tunnel/easy-vk-tunnel.sh

Запускаем

    easy-vk-tunnel/easy-vk-tunnel.sh

Вы получите ссылку формата vless, которую нужно вставить в ваше клиентское приложение. Vk-tunnel запустится в фоне. Скрипт напишет как его убить через kill, если вы решите завершить процесс.

Если вам нужно перезапустить vk-tunnel, запустите скрипт ещё раз — он убъёт процесс и снова создаст свежую ссылку.

# Послесловие

Данный скрипт поможет вам попробовать провести свой vless-трафик через веб-сокеты к вашему серверу и далее в интернет или куда вы хотите по вашему усмотрению. У vk-tunnel есть ряд ограничений, которые нужно указать.

1. Имя хоста будет периодически меняться. VK выдаёт ID каждому туннелю и он временный. Поэтому периодически при перезапуске скрипта вы будете получать новую ссылку vless.
2. Vk-tunnel может зависать, особенно от высокой нагрузки, но данный скрипт не предусматривает принудительную перезагрузку, так как vk-tunnel никак не сигнализирует о том, что он завис. Для перезагрузки запустите скрипт ещё раз.
3. Если вы изменяете порт инбаунда, то само собой нужно указать новое значение переменной в скрипте, убить вручную запущенный процесс vk-tunnel и запустить скрипт заново. При изменении UUID или Path убивать скрипт вручную необязательно, скрипт сам найдёт процесс по порту и убьёт его.

# Лицензия

Этот проект распространяется под лицензией CC BY-NC 4.0, запрещающей коммерческое использование. 
